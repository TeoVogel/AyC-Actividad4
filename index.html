<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Actividad 4 - Grupo O</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css">
  </head>
  <body>
  <section class="section">
    <div class="container">
        <p class="title is-4 mt-4 mb-1">
            Dígitos iniciales:
        </p>
        <input class="input is-medium is-primary" type="number" id="inputNumber" name="inputNumber" min="100000" max="999999999999" value="175102" >
    </div>
    <div class="container">
        <p class="title is-4 mt-5 mb-1">
            Pasos máximos (K):
        </p>
        <input class="input is-medium is-primary" type="number" id="inputK" name="inputK" min="1" max="100" value="3" >
    </div>
    <div class="container has-text-centered mt-6">
        <button class="button is-primary is-medium" onclick="start()">Empezar!</button>
    </div>
  </section>
  <section class="section">
    <div class="container has-text-centered box">
        <p id="currentNum" class="title is-1 mb-5 mt-2 is-family-monospace">
            ...
        </p>
        <button id="nextButton" class="button is-primary is-medium mb-2" onclick="nextStep()" disabled>Siguiente</button>
        <p id="currentStep" class="title is-5 mb-2 mt-2">
            ...
        </p>
    </div>
  </section>
  </body>

  <script>

    var currentNumArray = []
    var k = -1
    var stepCount = -1
    var digitsInBestPos = -1
    var earlyFinish = false

      function start() {
        var currentNum = document.getElementById("inputNumber").value
        currentNumArray = String(currentNum).split("").map((currentNum)=>{
            return Number(currentNum)
        })
        k = Number(document.getElementById("inputK").value)
        stepCount = 0
        digitsInBestPos = 0
        earlyFinish = false

        updateUI()
      }

      function nextStep() {
        if (!applyGreedyAlgorithmOnce()) {
            earlyFinish = true
        }
        stepCount++
        updateUI()
      }

      function applyGreedyAlgorithmOnce() {
        var selectedPos = -1
        var selectedPosPotential = 0
        var selectedPosCurrentValue = 0
        for (let i = digitsInBestPos; i < currentNumArray.length; i++) {
            var digit = currentNumArray[i]
            var digitPosRTL = currentNumArray.length - i - 1
            var digitCurrentValue = digit * Math.pow(10, digitPosRTL)
            var digitPotential = digit * Math.pow(10, Math.min(digitPosRTL + k - stepCount, currentNumArray.length - 1 - digitsInBestPos))
            console.log("i=" + i + ", [" + digit + "], " + digitCurrentValue + ", " + digitPotential)
            console.log(digitPosRTL + k - stepCount)
            if (digitPotential - digitCurrentValue > selectedPosPotential - selectedPosCurrentValue) {
                if (currentNumArray[i] > currentNumArray[i-1]) {
                    selectedPos = i
                    selectedPosPotential = digitPotential
                    selectedPosCurrentValue = digitCurrentValue
                }
            }
        }

        console.log("")
        if (selectedPos != -1) {
          var aux = currentNumArray[selectedPos - 1]
          currentNumArray[selectedPos - 1] = currentNumArray[selectedPos]
          currentNumArray[selectedPos] = aux
          if (selectedPosPotential == selectedPosCurrentValue * 10) {
            digitsInBestPos++
          }
          return true
        }
        return false
      }

      function updateUI() {
        document.getElementById("currentNum").innerText = Number(currentNumArray.join(''))
        document.getElementById("currentStep").innerText = "Paso: " + stepCount
        document.getElementById("nextButton").disabled = stepCount == k || earlyFinish
      }

  </script>
</html>